!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JediValidate=t():e.JediValidate=t()}(this,function(){return function(e){function t(i){if(s[i])return s[i].exports;var r=s[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var s={};return t.m=e,t.c=s,t.p="/dist/",t(0)}([function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),o=s(1),a=i(o),u=s(2),l=function(){function e(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var i={ajax:{url:null,enctype:"application/x-www-form-urlencoded",sendType:"serialize",method:"GET"},rules:{},messages:{},containers:{parent:"form-group",message:"help-block",baseMessage:"base-error"},states:{error:"error",valid:"valid",pristine:"pristine",dirty:"dirty"},formStatePrefix:"jedi-",callbacks:{success:function(){},error:function(){}},clean:!0,redirect:!0,language:"en"};this.root=t,this.options=(0,a["default"])(i,s),this.fields={},this.inputs={},this.messages={},this.rules={},this.cacheNodes();var n=e.getFormOptions(this.nodes.form);this.options=(0,a["default"])(this.options,i),this.options=(0,a["default"])(this.options,n),this.options=(0,a["default"])(this.options,s),(0,u.setLanguage)(s.language);for(var o in s.translations)for(var l in s.translations[o])(0,u.addTranslation)(l,s.translations[o][l],o);this.initMethods(),this.ready()}return n(e,[{key:"cacheNodes",value:function(){this.nodes={form:this.root.querySelector("form"),inputs:this.root.querySelectorAll("[name]"),baseMessage:this.root.querySelector("."+this.options.containers.baseMessage)}}},{key:"ready",value:function(){var e=this;this.nodes.form.setAttribute("novalidate","novalidate"),this.nodes.form.addEventListener("submit",function(t){var s=e.checkForm();if(0!==Object.keys(s).length)return e.options.callbacks.error(s),void t.preventDefault();if(!e.options.ajax||!e.options.ajax.url)return void e.options.callbacks.success(s,t);t.preventDefault();var i=e.getData();e.send((0,a["default"])(e.options.ajax,{data:i}))}),this.nodes.inputs.forEach(function(t){var s=t.name;if(e.inputs[s])Array.isArray(e.inputs[s])?e.inputs[s].push(t):e.inputs[s]=[e.inputs[s],t];else{e.inputs[s]=t;var i=t.parentNode;do if(i.classList.contains(e.options.containers.parent)){e.fields[s]=i;break}while(i=i.parentNode);if(!e.fields[s])throw"Have no parent field";e.fields[s].classList.add(e.options.states.pristine);var r=e.fields[s].querySelector("."+e.options.containers.message);r?e.messages[s]=r:(e.messages[s]=document.createElement("div"),e.messages[s].classList.add(e.options.containers.message),e.fields[s].appendChild(e.messages[s])),e.defineRules(s)}t.addEventListener("change",function(){e.fields[s].classList.remove(e.options.states.dirty),e.checkInput(s)}),t.addEventListener("input",function(){e.fields[s].classList.remove(e.options.states.pristine),e.fields[s].classList.add(e.options.states.dirty)})})}},{key:"send",value:function(e){var t=this,s=new XMLHttpRequest;s.open(e.method,e.url+("GET"===e.method.toUpperCase()?"?"+e.data:""),!0),"serialize"===e.sendType?s.setRequestHeader("Content-type",e.enctype):"json"===e.sendType&&s.setRequestHeader("Content-type","application/json; charset=utf-8"),s.onreadystatechange=function(){if(4==s.readyState)if(200==s.status){var i={};try{i=JSON.parse(s.responseText)}catch(r){i.validationErrors={base:["JSON parsing error"]}}if(i.validationErrors){t.options.callbacks.error(i.validationErrors),i.validationErrors.base?(t.nodes.baseMessage.innerHTML=i.validationErrors.base.join(", "),t.root.classList.add(t.options.formStatePrefix+t.options.states.error),t.root.classList.remove(t.options.formStatePrefix+t.options.states.valid),delete i.validationErrors.base):t.nodes.baseMessage.innerHTML="";for(var n in i.validationErrors)t.markError(n,i.validationErrors[n])}else{if(t.options.callbacks.success(i),t.options.redirect&&i.redirect)return void(window.location.href=i.redirect);t.options.clean&&t.nodes.form.reset()}}else console.warn(e.method+" "+e.url+" "+s.status+" ("+s.statusText+")"),t.nodes.baseMessage.innerHTML="Can not send form!",t.root.classList.add(t.options.formStatePrefix+t.options.states.error),t.root.classList.remove(t.options.formStatePrefix+t.options.states.valid)},s.send("POST"===e.method.toUpperCase()?e.data:"")}},{key:"getData",value:function(){var t="";if("serialize"===this.options.sendType){for(var s in this.inputs)t+=s+"="+encodeURIComponent(e.getInputValue(this.inputs[s]))+"&";t=t.slice(0,-1)}else if("formData"===this.options.sendType){t=new FormData;for(var i in this.inputs)if(this.inputs[i].type&&"file"===this.inputs[i].type)if(this.inputs[i].hasAttribute("multiple"))for(var r=0;r<this.inputs[i].files.length;r++)t.append(i+"[]",this.inputs[i].files[r]);else t.append(i,this.inputs[i].files[0]);else t.append(i,e.getInputValue(this.inputs[i]))}else if("json"===this.options.sendType){t={};for(var n in this.nodes.inputs){var o=this.nodes.inputs[n];t=(0,a["default"])(t,e.parseInputName(o.name,e.getInputValue(o)))}t=JSON.stringify(t)}return t}},{key:"defineRules",value:function(e){var t=this.inputs[e];this.rules[e]={};var s=["required","email","tel","url"];for(var i in s){var r=s[i];(t.hasAttribute(r)||t.type===r||t.classList.contains(r))&&(this.rules[e][r]=!0)}t.hasAttribute("pattern")&&(this.rules[e].regexp=new RegExp(t.getAttribute("pattern"))),this.options.rules[e]&&(this.rules[e]=(0,a["default"])(this.rules[e],this.options.rules[e]));for(var n in this.rules[e])this.rules[e][n]&&this.fields[e].classList.add(n)}},{key:"checkForm",value:function(){var e={};for(var t in this.rules){var s=this.checkInput(t);s.length&&(e[t]=s)}return e}},{key:"checkInput",value:function(t){var s=this.rules[t],i=[],r=!this.methods.required.func(e.getInputValue(this.inputs[t]),this.inputs[t]);if(r&&s.required)i.push(this.getErrorMessage(t,"required"));else if(!r)for(var n in s){var o=s[n];if(o)if(this.methods[n]){var a=this.methods[n].func(e.getInputValue(this.inputs[t]),this.inputs[t],o);a||i.push(this.getErrorMessage(t,n))}else i.push('Method "'+n+'" not found')}return i.length?this.markError(t,i):this.markValid(t),i}},{key:"markError",value:function(e,t){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.error),this.fields[e].classList.remove(this.options.states.valid),this.messages[e].innerHTML=t.join(", "))}},{key:"markValid",value:function(e){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.valid),this.fields[e].classList.remove(this.options.states.error),this.messages[e].innerHTML="")}},{key:"getErrorMessage",value:function(e,t){var s="";return s=this.options.messages[e]&&this.options.messages[e][t]?this.options.messages[e][t]:this.methods[t].message}},{key:"addMethod",value:function(e,t,s){this.methods[e]={func:t,message:s}}},{key:"initMethods",value:function(){this.methods={},this.addMethod("required",function(e){return e&&""!==e.trim()},(0,u.translate)("This field is required")),this.addMethod("regexp",function(e,t,s){return s.test(e)},(0,u.translate)("Please, provide correct value")),this.addMethod("email",function(e){return/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(e)},(0,u.translate)("This email is incorrect")),this.addMethod("filesize",function(e,t,s){return Array.prototype.slice.call(t.files).reduce(function(e,t){return t.size<s&&e},!0)},(0,u.translate)("This file is too large")),this.addMethod("extension",function(e,t,s){return Array.prototype.slice.call(t.files).reduce(function(e,t){return s.indexOf(t.name.split(".").pop())!==-1&&e},!0)},(0,u.translate)("This extension is not supported")),this.addMethod("tel",function(e){return/^([\+]+)*[0-9\x20\x28\x29\-]{5,20}$/.test(e)},(0,u.translate)("This phone number is incorrect")),this.addMethod("url",function(e){return/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi.test(e)},(0,u.translate)("Wrong url"))}}],[{key:"getFormOptions",value:function(e){var t={ajax:{}};return e.getAttribute("method")&&(t.ajax.method=e.getAttribute("method")),e.getAttribute("action")&&(t.ajax.url=e.getAttribute("action")),e.getAttribute("enctype")&&(t.ajax.enctype=e.getAttribute("enctype")),"multipart/form-data"===t.ajax.enctype&&(t.ajax.sendType="formData"),t}},{key:"getRadioGroupValue",value:function(t){for(var s in t){var i=t[s],r=e.getInputValue(i);if(""!==r)return r}return""}},{key:"parseInputName",value:function(t,s){for(var i=/(\[(\w*)\]|\w*)/gi,r=void 0,n=[];null!==(r=i.exec(t));)r.index===i.lastIndex&&i.lastIndex++,r[2]?n.push(r[2]):n.push(r[1]);return e.createObject(n,s)}},{key:"createObject",value:function(t,s){var i=t[0];if(0===i.length)return s;if("[]"===i)return[e.createObject(t.slice(1),s)];var r={};return r[i]=e.createObject(t.slice(1),s),r}},{key:"getInputValue",value:function(t){if(Array.isArray(t))return e.getRadioGroupValue(t);var s="",i=t.type;if("select-one"===i)return t.options.length&&(s=t.options[t.selectedIndex].value),s;if("select-multiple"===i){s=[];for(var r=0;r<t.options.length;r++)t.options[r].selected&&s.push(t.options[r].value);return 0===s.length&&(s=""),s}return"checkbox"===i||"radio"===i?t.checked?t.value:"":t.value}},{key:"addToDictionary",value:function(e,t,s){(0,u.addTranslation)(e,t,s)}}]),e}();e.exports=l},function(e,t,s){var i,r;!function(n,o){i=o,r="function"==typeof i?i.call(t,s,t,e):i,!(void 0!==r&&(e.exports=r))}(this,function(){function e(e){var t=e&&"object"==typeof e;return t&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function t(e){return Array.isArray(e)?[]:{}}function s(s,i){var r=i&&i.clone===!0;return r&&e(s)?n(t(s),s,i):s}function i(t,i,r){var o=t.slice();return i.forEach(function(i,a){"undefined"==typeof o[a]?o[a]=s(i,r):e(i)?o[a]=n(t[a],i,r):t.indexOf(i)===-1&&o.push(s(i,r))}),o}function r(t,i,r){var o={};return e(t)&&Object.keys(t).forEach(function(e){o[e]=s(t[e],r)}),Object.keys(i).forEach(function(a){e(i[a])&&t[a]?o[a]=n(t[a],i[a],r):o[a]=s(i[a],r)}),o}function n(e,t,n){var o=Array.isArray(t),a=n||{arrayMerge:i},u=a.arrayMerge||i;return o?Array.isArray(e)?u(e,t,n):s(t,n):r(e,t,n)}return n})},function(e,t,s){"use strict";function i(e){a=e}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return o[t]&&o[t][e]||e}function n(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;void 0===o[s]&&(o[s]={}),o[s][e]=t}Object.defineProperty(t,"__esModule",{value:!0}),t.setLanguage=i,t.translate=r,t.addTranslation=n;var o=s(3),a="en"},function(e,t){e.exports={ru:{"This field is required":"Это поле необходимо заполнить","Please, provide correct value":"Пожалуйста, введите корректное значение","This email is incorrect":"Пожалуйста, введите корректный адрес электронной почты","This file is too large":"Попробуйте загрузить файл поменьше","This extension is not supported":"Пожалуйста, выберите файл с правильным расширением","This phone number is incorrect":"Не корректный номер телефона","Wrong url":"Не корректный url"}}}])});
//# sourceMappingURL=jedi-validate.min.map