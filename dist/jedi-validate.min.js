"use strict";function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function isObject(e){return e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&!Array.isArray(e)&&null!==e}function mergeDeep(e,t){var s=Object.assign({},e);return isObject(e)&&isObject(t)&&Object.keys(t).forEach(function(i){isObject(t[i])&&i in e?s[i]=mergeDeep(e[i],t[i]):Object.assign(s,_defineProperty({},i,t[i]))}),s}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),JediValidate=function(){function e(t){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,e);var i={ajax:{url:null,enctype:"application/x-www-form-urlencoded",method:"GET"},sendType:"serialize",rules:{},messages:{},containers:{parent:"form-group",message:"help-block",baseMessage:"base-error"},states:{error:"error",valid:"valid",pristine:"pristine",dirty:"dirty"},callbacks:{success:function(){},error:function(){}},clean:!0,redirect:!0};this.root=t,this.options=mergeDeep(i,s),this.fields={},this.inputs={},this.messages={},this.rules={},this._cacheNodes();var r=e.getFormOptions(this.nodes.form);this.options=mergeDeep(this.options,i),this.options=mergeDeep(this.options,r),this.options=mergeDeep(this.options,s),this._ready()}return _createClass(e,[{key:"_cacheNodes",value:function(){this.nodes={form:this.root.querySelector("form"),inputs:this.root.querySelectorAll("[name]"),baseMessage:this.root.querySelector("."+this.options.containers.baseMessage)}}},{key:"_ready",value:function(){var e=this;this.nodes.form.setAttribute("novalidate","novalidate"),this.nodes.form.addEventListener("submit",function(t){var s=e.checkForm();return 0!==Object.keys(s).length?(e.options.callbacks.error(s),void t.preventDefault()):void(e.options.ajax&&(t.preventDefault(),e._send()))}),this.nodes.inputs.forEach(function(t){var s=t.name;if(e.inputs[s])Array.isArray(e.inputs[s])?e.inputs[s].push(t):e.inputs[s]=[e.inputs[s],t];else{e.inputs[s]=t;var i=t.parentNode;do if(i.classList.contains(e.options.containers.parent)){e.fields[s]=i;break}while(i=i.parentNode);if(!e.fields[s])throw"Have no parent field";e.fields[s].classList.add(e.options.states.pristine);var r=e.fields[s].querySelector("."+e.options.containers.message);r?e.messages[s]=r:(e.messages[s]=document.createElement("div"),e.messages[s].classList.add(e.options.containers.message),e.fields[s].appendChild(e.messages[s])),e._defineRules(s)}t.addEventListener("change",function(){e.fields[s].classList.remove(e.options.states.dirty),e.checkInput(s)}),t.addEventListener("input",function(){e.fields[s].classList.remove(e.options.states.pristine),e.fields[s].classList.add(e.options.states.dirty)})})}},{key:"_send",value:function(t){var s=this,i="",r=new XMLHttpRequest;if("serialize"===this.options.sendType){for(var n in this.inputs)i+=n+"="+encodeURIComponent(e.getInputValue(this.inputs[n]))+"&";i=i.slice(0,-1)}else if("formData"===this.options.sendType)i=new FormData(this.nodes.form);else if("json"===this.options.sendType){i={};for(var a in this.inputs)i=mergeDeep(i,e.parseInputName(a,e.getInputValue(this.inputs[a])));i=JSON.stringify(i)}r.open(this.options.ajax.method,this.options.ajax.url+("GET"===this.options.ajax.method.toUpperCase()?"?"+i:""),!0),"serialize"===this.options.sendType?r.setRequestHeader("Content-type",this.options.ajax.enctype):"json"===this.options.sendType&&r.setRequestHeader("Content-type","application/json; charset=utf-8"),r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){var e={};try{e=JSON.parse(r.responseText)}catch(i){e.validationErrors={base:["JSON parsing error"]}}if(e.validationErrors){s.options.callbacks.error(e.validationErrors),e.validationErrors.base?(s.nodes.baseMessage.innerHTML=e.validationErrors.base.join(", "),s.root.classList.add(s.options.states.error),s.root.classList.remove(s.options.states.valid),delete e.validationErrors.base):s.nodes.baseMessage.innerHTML="";for(var n in e.validationErrors)s._markError(n,e.validationErrors[n])}else{if(s.options.callbacks.success(e),s.options.redirect&&e.redirect)return void(window.location.href=e.redirect);s.options.clean&&s.nodes.form.reset()}}else console.warn(t.method+" "+t.url+" "+r.status+" ("+r.statusText+")"),s.nodes.baseMessage.innerHTML="Can not send form!",s.root.classList.add(s.options.states.error),s.root.classList.remove(s.options.states.valid)},r.send("POST"===this.options.ajax.method.toUpperCase()?i:"")}},{key:"_defineRules",value:function(e){var t=this.inputs[e];this.rules[e]={};var s=["required","email","tel","url"],i=!0,r=!1,n=void 0;try{for(var a,o=s[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var u=a.value;(t.hasAttribute(u)||t.classList.contains(u))&&(this.rules[e][u]=!0)}}catch(l){r=!0,n=l}finally{try{!i&&o["return"]&&o["return"]()}finally{if(r)throw n}}t.hasAttribute("pattern")&&(this.rules[e].regexp=new RegExp(t.getAttribute("pattern"))),this.rules[e]=mergeDeep(this.rules[e],this.options.rules[e]);for(var d in this.rules[e])this.rules[e][d]&&this.fields[e].classList.add(d)}},{key:"checkForm",value:function(){var e={};for(var t in this.rules){var s=this.checkInput(t);s.length&&(e[t]=s)}return e}},{key:"checkInput",value:function(t){var s=this.rules[t],i=[],r=!e.methods.required.func(e.getInputValue(this.inputs[t]),this.inputs[t]);if(r&&s.required)i.push(this._getErrorMessage(t));else if(!r)for(var n in s){var a=s[n];if(a)if(e.methods[n]){var o=e.methods[n].func(e.getInputValue(this.inputs[t]),this.inputs[t],a);o||i.push(this._getErrorMessage(t))}else i.push('Method "'+n+'" not found')}return i.length?this._markError(t,i):this._markValid(t),i}},{key:"_markError",value:function(e,t){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.error),this.fields[e].classList.remove(this.options.states.valid),this.messages[e].innerHTML=t.join(", "))}},{key:"_markValid",value:function(e){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.valid),this.fields[e].classList.remove(this.options.states.error),this.messages[e].innerHTML="")}},{key:"_getErrorMessage",value:function(t){var s="";return s=this.options.messages[t]&&this.options.messages[t].required?this.options.messages[t].required:e.methods.required.message}}],[{key:"getFormOptions",value:function(e){var t={ajax:{}};return e.getAttribute("method")&&(t.ajax.method=e.getAttribute("method")),e.getAttribute("action")&&(t.ajax.url=e.getAttribute("action")),e.getAttribute("enctype")&&(t.ajax.enctype=e.getAttribute("enctype")),"multipart/form-data"===t.ajax.enctype&&(t.sendType="formData"),t}},{key:"getRadioGroupValue",value:function(t){var s=!0,i=!1,r=void 0;try{for(var n,a=t[Symbol.iterator]();!(s=(n=a.next()).done);s=!0){var o=n.value,u=e.getInputValue(o);if(""!==u)return u}}catch(l){i=!0,r=l}finally{try{!s&&a["return"]&&a["return"]()}finally{if(i)throw r}}return""}},{key:"parseInputName",value:function(t,s){for(var i,r=/(\[(\w*)\]|\w*)/gi,n=[];null!==(i=r.exec(t));)i.index===r.lastIndex&&r.lastIndex++,i[2]?n.push(i[2]):n.push(i[1]);return e.createObject(n,s)}},{key:"createObject",value:function(t,s){var i=t[0];if(0===i.length)return s;if("[]"===i)return[e.createObject(t.slice(1),s)];var r={};return r[i]=e.createObject(t.slice(1),s),r}},{key:"getInputValue",value:function(t){if(Array.isArray(t))return e.getRadioGroupValue(t);var s="",i=t.type;if("select-one"===i)return t.options.length&&(s=t.options[t.selectedIndex].value),s;if("select-multiple"===i){s=[];for(var r=0;r<t.options.length;r++)t.options[r].selected&&s.push(t.options[r].value);return 0===s.length&&(s=""),s}return"checkbox"===i||"radio"===i?t.checked?t.value:"":t.value}}]),e}();JediValidate.methods={},JediValidate.addMethod=function(e,t,s){JediValidate.methods[e]={func:t,message:s}},JediValidate.addMethod("required",function(e){return e&&""!==e.trim()},"Это поле необходимо заполнить"),JediValidate.addMethod("regexp",function(e,t,s){return s.test(e)},"Пожалуйста, введите корректное значение"),JediValidate.addMethod("email",function(e){return/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(e)},"Пожалуйста, введите корректный адрес электронной почты"),JediValidate.addMethod("filesize",function(e,t,s){return!t.get(0).files[0]||t.get(0).files[0].size<=s},"Попробуйте загрузить файл поменьше"),JediValidate.addMethod("extension",function(e,t,s){return!t.get(0).files[0]||s.indexOf(t.get(0).files[0].name.split(".").pop())>-1},"Пожалуйста, выберите файл с правильным расширением"),JediValidate.addMethod("tel",function(e){return/^([\+]+)*[0-9\x20\x28\x29\-]{5,20}$/.test(e)},"Не корректный номер телефона"),JediValidate.addMethod("url",function(e){return/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi.test(e)},"Не корректный url");
//# sourceMappingURL=jedi-validate.min.js.map
