!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JediValidate=t():e.JediValidate=t()}(this,function(){return function(e){function t(r){if(s[r])return s[r].exports;var i=s[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var s={};return t.m=e,t.c=s,t.p="/dist/",t(0)}([function(e,t,s){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(Array.isArray(e)){for(var t=0,s=Array(e.length);t<e.length;t++)s[t]=e[t];return s}return Array.from(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}(),a=s(1),u=r(a),l=s(2),c=function(){function e(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,e);var r={ajax:{url:null,enctype:"application/x-www-form-urlencoded",sendType:"serialize",method:"GET"},rules:{},messages:{},containers:{parent:"form-group",message:"help-block",baseMessage:"base-error"},states:{error:"error",valid:"valid",pristine:"pristine",dirty:"dirty"},formStatePrefix:"jedi-",callbacks:{success:function(){},error:function(){}},clean:!0,redirect:!0,language:"en"};this.root=t,this.options=(0,u["default"])(r,s),this.fields={},this.inputs={},this.messages={},this.rules={},this.cacheNodes();var i=e.getFormOptions(this.nodes.form);this.options=(0,u["default"])(this.options,r),this.options=(0,u["default"])(this.options,i),this.options=(0,u["default"])(this.options,s),(0,l.setLanguage)(s.language);for(var o in s.translations)for(var a in s.translations[o])(0,l.addTranslation)(a,s.translations[o][a],o);this.initMethods(),this.ready()}return o(e,[{key:"cacheNodes",value:function(){this.nodes={form:this.root.querySelector("form"),inputs:this.root.querySelectorAll("[name]"),baseMessage:this.root.querySelector("."+this.options.containers.baseMessage)}}},{key:"ready",value:function(){var e=this;this.nodes.form.setAttribute("novalidate","novalidate"),this.nodes.form.addEventListener("submit",function(t){var s=e.checkForm();if(0!==Object.keys(s).length){try{e.options.callbacks.error(s)}catch(r){console.error(r)}return void t.preventDefault()}if(e.options.ajax&&e.options.ajax.url){t.preventDefault();var i=e.getData();e.send((0,u["default"])(e.options.ajax,{data:i}))}else try{e.options.callbacks.success(s,t)}catch(r){console.error(r)}}),this.nodes.inputs.forEach(function(t){var s=t.name;if(e.inputs[s])Array.isArray(e.inputs[s])?e.inputs[s].push(t):e.inputs[s]=[e.inputs[s],t];else{e.inputs[s]=t;var r=t.parentNode;do if(r.classList.contains(e.options.containers.parent)){e.fields[s]=r;break}while(r=r.parentNode);if(!e.fields[s])throw new Error("Have no parent field");e.fields[s].classList.add(e.options.states.pristine);var i=e.fields[s].querySelector("."+e.options.containers.message);i?e.messages[s]=i:(e.messages[s]=document.createElement("div"),e.messages[s].classList.add(e.options.containers.message),e.fields[s].appendChild(e.messages[s])),e.defineRules(s)}t.addEventListener("change",function(){e.fields[s].classList.remove(e.options.states.dirty),e.checkInput(s)}),t.addEventListener("input",function(){e.fields[s].classList.remove(e.options.states.pristine),e.fields[s].classList.add(e.options.states.dirty)})})}},{key:"send",value:function(e){var t=this,s=new XMLHttpRequest;s.open(e.method,e.url+("GET"===e.method.toUpperCase()?"?"+e.data:""),!0),"serialize"===e.sendType?s.setRequestHeader("Content-type",e.enctype):"json"===e.sendType&&s.setRequestHeader("Content-type","application/json; charset=utf-8"),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var r={};try{r=JSON.parse(s.responseText)}catch(i){r.validationErrors={base:["JSON parsing error"]}}if(r.validationErrors){try{t.options.callbacks.error(r.validationErrors)}catch(i){console.error(i)}r.validationErrors.base?(t.nodes.baseMessage.innerHTML=r.validationErrors.base.join(", "),t.root.classList.add(t.options.formStatePrefix+t.options.states.error),t.root.classList.remove(t.options.formStatePrefix+t.options.states.valid),delete r.validationErrors.base):t.nodes.baseMessage.innerHTML="";for(var n in r.validationErrors)t.markError(n,r.validationErrors[n])}else{try{t.options.callbacks.success(r)}catch(i){console.error(i)}if(t.options.redirect&&r.redirect)return void(window.location.href=r.redirect);t.options.clean&&t.nodes.form.reset()}}else console.warn(e.method+" "+e.url+" "+s.status+" ("+s.statusText+")"),t.nodes.baseMessage.innerHTML="Can not send form!",t.root.classList.add(t.options.formStatePrefix+t.options.states.error),t.root.classList.remove(t.options.formStatePrefix+t.options.states.valid)},s.send("POST"===e.method.toUpperCase()?e.data:"")}},{key:"getData",value:function(){var t="";if("serialize"===this.options.ajax.sendType){for(var s in this.inputs)t+=s+"="+encodeURIComponent(e.getInputValue(this.inputs[s]))+"&";t=t.slice(0,-1)}else if("formData"===this.options.ajax.sendType){t=new FormData;for(var r in this.inputs)if(this.inputs[r].type&&"file"===this.inputs[r].type)if(this.inputs[r].hasAttribute("multiple"))for(var i=0;i<this.inputs[r].files.length;i+=1)t.append(r+"[]",this.inputs[r].files[i]);else t.append(r,this.inputs[r].files[0]);else t.append(r,e.getInputValue(this.inputs[r]))}else if("json"===this.options.ajax.sendType){t={};for(var n in this.nodes.inputs){var o=this.nodes.inputs[n];t=(0,u["default"])(t,e.parseInputName(o.name,e.getInputValue(o)))}t=JSON.stringify(t)}return t}},{key:"defineRules",value:function(e){var t=this.inputs[e];this.rules[e]={};var s=["required","email","tel","url"];for(var r in s){var i=s[r];(t.hasAttribute(i)||t.type===i||t.classList.contains(i))&&(this.rules[e][i]=!0)}t.hasAttribute("pattern")&&(this.rules[e].regexp=new RegExp(t.getAttribute("pattern"))),this.options.rules[e]&&(this.rules[e]=(0,u["default"])(this.rules[e],this.options.rules[e]));for(var n in this.rules[e])this.rules[e][n]&&this.fields[e].classList.add(n)}},{key:"checkForm",value:function(){var e={};for(var t in this.rules){var s=this.checkInput(t);s.length&&(e[t]=s)}return e}},{key:"checkInput",value:function(t){var s=this.rules[t],r=[],i=!this.methods.required.func(e.getInputValue(this.inputs[t]),this.inputs[t]);if(i&&s.required)r.push(this.getErrorMessage(t,"required"));else if(!i)for(var n in s){var o=s[n];if(o)if(this.methods[n]){var a=this.methods[n].func(e.getInputValue(this.inputs[t]),this.inputs[t],o);a||r.push(this.getErrorMessage(t,n))}else r.push('Method "'+n+'" not found')}return r.length?this.markError(t,r):this.markValid(t),r}},{key:"markError",value:function(e,t){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.error),this.fields[e].classList.remove(this.options.states.valid),this.messages[e].innerHTML=t.join(", "))}},{key:"markValid",value:function(e){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.valid),this.fields[e].classList.remove(this.options.states.error),this.messages[e].innerHTML="")}},{key:"getErrorMessage",value:function(e,t){var s="";return s=this.options.messages[e]&&this.options.messages[e][t]?this.options.messages[e][t]:this.methods[t].message}},{key:"addMethod",value:function(e,t,s){this.methods[e]={func:t,message:s}}},{key:"initMethods",value:function(){this.methods={},this.addMethod("required",function(e){return e&&""!==e.trim()},(0,l.translate)("This field is required")),this.addMethod("regexp",function(e,t,s){return s.test(e)},(0,l.translate)("Please, provide correct value")),this.addMethod("email",function(e){return/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(e)},(0,l.translate)("This email is incorrect")),this.addMethod("filesize",function(e,t,s){return[].concat(i(t.files)).reduce(function(e,t){return t.size<s&&e},!0)},(0,l.translate)("This file is too large")),this.addMethod("extension",function(e,t,s){return[].concat(i(t.files)).reduce(function(e,t){return s.indexOf(t.name.split(".").pop())!==-1&&e},!0)},(0,l.translate)("This extension is not supported")),this.addMethod("tel",function(e){return/^([\+]+)*[0-9\x20\x28\x29\-]{5,20}$/.test(e)},(0,l.translate)("This phone number is incorrect")),this.addMethod("url",function(e){return/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi.test(e)},(0,l.translate)("Wrong url"))}}],[{key:"getFormOptions",value:function(e){var t={ajax:{}};return e.getAttribute("method")&&(t.ajax.method=e.getAttribute("method")),e.getAttribute("action")&&(t.ajax.url=e.getAttribute("action")),e.getAttribute("enctype")&&(t.ajax.enctype=e.getAttribute("enctype")),"multipart/form-data"===t.ajax.enctype&&(t.ajax.sendType="formData"),t}},{key:"getRadioGroupValue",value:function(t){for(var s in t){var r=t[s],i=e.getInputValue(r);if(""!==i)return i}return""}},{key:"parseInputName",value:function(t,s){var r=/(\[(\w*)\]|\w*)/gi,i=void 0,n=[];for(i=r.exec(t);null!==i;)i.index===r.lastIndex&&(r.lastIndex+=1),i[2]?n.push(i[2]):n.push(i[1]),i=r.exec(t);return e.createObject(n,s)}},{key:"createObject",value:function(t,s){var r=t[0];if(0===r.length)return s;if("[]"===r)return[e.createObject(t.slice(1),s)];var i={};return i[r]=e.createObject(t.slice(1),s),i}},{key:"getInputValue",value:function(t){if(Array.isArray(t))return e.getRadioGroupValue(t);var s="",r=t.type;if("select-one"===r)return t.options.length&&(s=t.options[t.selectedIndex].value),s;if("select-multiple"===r){for(var i=[],n=0;n<t.options.length;n+=1)t.options[n].selected&&i.push(t.options[n].value);return 0===i.length?"":i}return"checkbox"===r||"radio"===r?t.checked?t.value:"":t.value}},{key:"addToDictionary",value:function(e,t,s){(0,l.addTranslation)(e,t,s)}}]),e}();e.exports=c},function(e,t,s){var r,i;!function(n,o){r=o,i="function"==typeof r?r.call(t,s,t,e):r,!(void 0!==i&&(e.exports=i))}(this,function(){function e(e){var t=e&&"object"==typeof e;return t&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function t(e){return Array.isArray(e)?[]:{}}function s(s,r){var i=r&&r.clone===!0;return i&&e(s)?n(t(s),s,r):s}function r(t,r,i){var o=t.slice();return r.forEach(function(r,a){"undefined"==typeof o[a]?o[a]=s(r,i):e(r)?o[a]=n(t[a],r,i):t.indexOf(r)===-1&&o.push(s(r,i))}),o}function i(t,r,i){var o={};return e(t)&&Object.keys(t).forEach(function(e){o[e]=s(t[e],i)}),Object.keys(r).forEach(function(a){e(r[a])&&t[a]?o[a]=n(t[a],r[a],i):o[a]=s(r[a],i)}),o}function n(e,t,n){var o=Array.isArray(t),a=n||{arrayMerge:r},u=a.arrayMerge||r;return o?Array.isArray(e)?u(e,t,n):s(t,n):i(e,t,n)}return n})},function(e,t,s){"use strict";function r(e){a=e}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return o[t]&&o[t][e]||e}function n(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;void 0===o[s]&&(o[s]={}),o[s][e]=t}Object.defineProperty(t,"__esModule",{value:!0}),t.setLanguage=r,t.translate=i,t.addTranslation=n;var o=s(3),a="en"},function(e,t){e.exports={ru:{"This field is required":"Это поле необходимо заполнить","Please, provide correct value":"Пожалуйста, введите корректное значение","This email is incorrect":"Пожалуйста, введите корректный адрес электронной почты","This file is too large":"Попробуйте загрузить файл поменьше","This extension is not supported":"Пожалуйста, выберите файл с правильным расширением","This phone number is incorrect":"Не корректный номер телефона","Wrong url":"Не корректный url"}}}])});
//# sourceMappingURL=jedi-validate.min.map