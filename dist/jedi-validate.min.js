"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}(),JediValidate=function(){function e(t){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,e);var r={ajax:{dataType:"json"},sendType:"serialize",rules:{},messages:{},containers:{parent:"form-group",message:"help-block",baseMessage:"base-error"},states:{error:"error",valid:"valid"},callbacks:{success:function(){},error:function(){}}};this.root=t,this.options=Object.assign(r,s),this.fields={},this.inputs={},this.messages={},this.rules={},this._cacheNodes(),this._ready()}return _createClass(e,[{key:"_cacheNodes",value:function(){this.nodes={form:this.root.querySelector("form"),inputs:this.root.querySelectorAll("[name]"),baseMessage:this.root.querySelector("."+this.options.containers.baseMessage)}}},{key:"_ready",value:function(){var e=this;this.nodes.form.setAttribute("novalidate","novalidate"),this.nodes.form.addEventListener("submit",function(t){var s=e.checkForm();if(0!==Object.keys(s).length)return e.options.callbacks.error(s),void t.preventDefault();if(e.options.ajax){t.preventDefault();var r={};r.url=e.nodes.form.getAttribute("action"),r.method=e.nodes.form.getAttribute("method"),e._send(r)}}),this.nodes.inputs.forEach(function(t){var s=t.name;e.inputs[s]=t;var r=t.parentNode;do if(r.classList.contains(e.options.containers.parent)){e.fields[s]=r;break}while(r=r.parentNode);if(!e.fields[s])throw"Have no parent field";var i=e.fields[s].querySelector("."+e.options.containers.message);i?e.messages[s]=i:(e.messages[s]=document.createElement("div"),e.messages[s].classList.add(e.options.containers.message),e.fields[s].appendChild(e.messages[s])),e._defineRules(s),t.addEventListener("change",function(){e.checkInput(s)})})}},{key:"_send",value:function(e){var t=this,s="";this.nodes.inputs.forEach(function(e){s+=e.name+"="+encodeURIComponent(e.value)+"&"}),s=s.slice(0,-1);var r=new XMLHttpRequest;r.open("GET",e.url+("GET"===e.method.toUpperCase()?"?"+s:""),!0),r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){var s={};try{s=JSON.parse(r.responseText)}catch(i){s.validationErrors={base:["JSON parsing error"]}}if(s.validationErrors){t.options.callbacks.error(s.validationErrors),s.validationErrors.base?(t.nodes.baseMessage.innerHTML=s.validationErrors.base.join(", "),t.root.classList.add(t.options.states.error),t.root.classList.remove(t.options.states.valid),delete s.validationErrors.base):t.nodes.baseMessage.innerHTML="";for(var a in s.validationErrors)t._markError(a,s.validationErrors[a])}else{if(t.options.callbacks.success(s),t.options.redirect&&s.redirect)return void(window.location.href=s.redirect);t.options.clean&&t.nodes.form.reset()}}else console.warn(e.method+" "+e.url+" "+r.status+" ("+r.statusText+")"),t.nodes.baseMessage.innerHTML="Can not send form!",t.root.classList.add(t.options.states.error),t.root.classList.remove(t.options.states.valid)},r.send("POST"===e.method.toUpperCase()?s:"")}},{key:"_defineRules",value:function(e){var t=this.inputs[e];this.rules[e]={};var s=["required","email","tel","url"],r=!0,i=!1,a=void 0;try{for(var n,o=s[Symbol.iterator]();!(r=(n=o.next()).done);r=!0){var d=n.value;(t.hasAttribute(d)||t.classList.contains(d))&&(this.rules[e][d]=!0)}}catch(l){i=!0,a=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw a}}t.hasAttribute("pattern")&&(this.rules[e].regexp=new RegExp(t.getAttribute("pattern"))),this.rules[e]=Object.assign(this.rules[e],this.options.rules[e]);for(var u in this.rules[e])this.rules[e][u]&&this.fields[e].classList.add(u)}},{key:"checkForm",value:function(){var e={};for(var t in this.rules){var s=this.checkInput(t);s.length&&(e[t]=s)}return e}},{key:"checkInput",value:function(t){var s=this.rules[t],r=[],i=!e.methods.required.func(this.inputs[t].value,this.inputs[t]);if(i&&s.required)r.push(this._getErrorMessage(t));else if(!i)for(var a in s){var n=s[a];if(n)if(e.methods[a]){var o=e.methods[a].func(this.inputs[t].value,this.inputs[t],n);o||r.push(this._getErrorMessage(t))}else r.push('Method "'+a+'" not found')}return r.length?this._markError(t,r):this._markValid(t),r}},{key:"_markError",value:function(e,t){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.error),this.fields[e].classList.remove(this.options.states.valid),this.messages[e].innerHTML=t.join(", "))}},{key:"_markValid",value:function(e){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.valid),this.fields[e].classList.remove(this.options.states.error),this.messages[e].innerHTML="")}},{key:"_getErrorMessage",value:function(t){var s="";return s=this.options.messages[t]&&this.options.messages[t].required?this.options.messages[t].required:e.methods.required.message}}]),e}();JediValidate.methods={},JediValidate.addMethod=function(e,t,s){JediValidate.methods[e]={func:t,message:s}},JediValidate.addMethod("required",function(e,t){return e&&""!==e.trim()&&"checkbox"!==t.getAttribute("type")||"checkbox"===t.getAttribute("type")&&t.hasAttribute("checked")},"Это поле необходимо заполнить"),JediValidate.addMethod("regexp",function(e,t,s){return s.test(e)},"Пожалуйста, введите корректное значение"),JediValidate.addMethod("email",function(e){return/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(e)},"Пожалуйста, введите корректный адрес электронной почты"),JediValidate.addMethod("filesize",function(e,t,s){return!t.get(0).files[0]||t.get(0).files[0].size<=s},"Попробуйте загрузить файл поменьше"),JediValidate.addMethod("extension",function(e,t,s){return!t.get(0).files[0]||s.indexOf(t.get(0).files[0].name.split(".").pop())>-1},"Пожалуйста, выберите файл с правильным расширением"),JediValidate.addMethod("tel",function(e){return/^([\+]+)*[0-9\x20\x28\x29\-]{5,20}$/.test(e)},"Не корректный номер телефона"),JediValidate.addMethod("url",function(e){return/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi.test(e)},"Не корректный url");
//# sourceMappingURL=jedi-validate.min.js.map
