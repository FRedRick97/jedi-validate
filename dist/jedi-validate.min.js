!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JediValidate=t():e.JediValidate=t()}(this,function(){return function(e){function t(i){if(s[i])return s[i].exports;var r=s[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var s={};return t.m=e,t.c=s,t.p="",t(0)}([function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),o=s(1),a=i(o),u=function(){function e(t){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,e);var i={ajax:{url:null,enctype:"application/x-www-form-urlencoded",sendType:"serialize",method:"GET"},rules:{},messages:{},containers:{parent:"form-group",message:"help-block",baseMessage:"base-error"},states:{error:"error",valid:"valid",pristine:"pristine",dirty:"dirty"},formStatePrefix:"jedi-",callbacks:{success:function(){},error:function(){}},clean:!0,redirect:!0};this.root=t,this.options=(0,a["default"])(i,s),this.fields={},this.inputs={},this.messages={},this.rules={},this._cacheNodes();var n=e.getFormOptions(this.nodes.form);this.options=(0,a["default"])(this.options,i),this.options=(0,a["default"])(this.options,n),this.options=(0,a["default"])(this.options,s),this._ready()}return n(e,[{key:"_cacheNodes",value:function(){this.nodes={form:this.root.querySelector("form"),inputs:this.root.querySelectorAll("[name]"),baseMessage:this.root.querySelector("."+this.options.containers.baseMessage)}}},{key:"_ready",value:function(){var e=this;this.nodes.form.setAttribute("novalidate","novalidate"),this.nodes.form.addEventListener("submit",function(t){var s=e.checkForm();if(0!==Object.keys(s).length)return e.options.callbacks.error(s),void t.preventDefault();if(e.options.ajax&&e.options.ajax.url){t.preventDefault();var i=e.getData();e._send((0,a["default"])(e.options.ajax,{data:i}))}}),this.nodes.inputs.forEach(function(t){var s=t.name;if(e.inputs[s])Array.isArray(e.inputs[s])?e.inputs[s].push(t):e.inputs[s]=[e.inputs[s],t];else{e.inputs[s]=t;var i=t.parentNode;do if(i.classList.contains(e.options.containers.parent)){e.fields[s]=i;break}while(i=i.parentNode);if(!e.fields[s])throw"Have no parent field";e.fields[s].classList.add(e.options.states.pristine);var r=e.fields[s].querySelector("."+e.options.containers.message);r?e.messages[s]=r:(e.messages[s]=document.createElement("div"),e.messages[s].classList.add(e.options.containers.message),e.fields[s].appendChild(e.messages[s])),e._defineRules(s)}t.addEventListener("change",function(){e.fields[s].classList.remove(e.options.states.dirty),e.checkInput(s)}),t.addEventListener("input",function(){e.fields[s].classList.remove(e.options.states.pristine),e.fields[s].classList.add(e.options.states.dirty)})})}},{key:"_send",value:function(e){var t=this,s=new XMLHttpRequest;s.open(e.method,e.url+("GET"===e.method.toUpperCase()?"?"+e.data:""),!0),"serialize"===e.sendType?s.setRequestHeader("Content-type",e.enctype):"json"===e.sendType&&s.setRequestHeader("Content-type","application/json; charset=utf-8"),s.onreadystatechange=function(){if(4==s.readyState)if(200==s.status){var i={};try{i=JSON.parse(s.responseText)}catch(r){i.validationErrors={base:["JSON parsing error"]}}if(i.validationErrors){t.options.callbacks.error(i.validationErrors),i.validationErrors.base?(t.nodes.baseMessage.innerHTML=i.validationErrors.base.join(", "),t.root.classList.add(t.options.formStatePrefix+t.options.states.error),t.root.classList.remove(t.options.formStatePrefix+t.options.states.valid),delete i.validationErrors.base):t.nodes.baseMessage.innerHTML="";for(var n in i.validationErrors)t._markError(n,i.validationErrors[n])}else{if(t.options.callbacks.success(i),t.options.redirect&&i.redirect)return void(window.location.href=i.redirect);t.options.clean&&t.nodes.form.reset()}}else console.warn(e.method+" "+e.url+" "+s.status+" ("+s.statusText+")"),t.nodes.baseMessage.innerHTML="Can not send form!",t.root.classList.add(t.options.formStatePrefix+t.options.states.error),t.root.classList.remove(t.options.formStatePrefix+t.options.states.valid)},s.send("POST"===e.method.toUpperCase()?e.data:"")}},{key:"getData",value:function(){var t="";if("serialize"===this.options.sendType){for(var s in this.inputs)t+=s+"="+encodeURIComponent(e.getInputValue(this.inputs[s]))+"&";t=t.slice(0,-1)}else if("formData"===this.options.sendType){t=new FormData;for(var i in this.inputs)if(this.inputs[i].type&&"file"===this.inputs[i].type)if(this.inputs[i].hasAttribute("multiple"))for(var r=0;r<this.inputs[i].files.length;r++)t.append(i+"[]",this.inputs[i].files[r]);else t.append(i,this.inputs[i].files[0]);else t.append(i,e.getInputValue(this.inputs[i]))}else if("json"===this.options.sendType){t={};for(var n in this.nodes.inputs){var o=this.nodes.inputs[n];t=(0,a["default"])(t,e.parseInputName(o.name,e.getInputValue(o)))}t=JSON.stringify(t)}return t}},{key:"_defineRules",value:function(e){var t=this.inputs[e];this.rules[e]={};var s=["required","email","tel","url"];for(var i in s){var r=s[i];(t.hasAttribute(r)||t.type===r||t.classList.contains(r))&&(this.rules[e][r]=!0)}t.hasAttribute("pattern")&&(this.rules[e].regexp=new RegExp(t.getAttribute("pattern"))),this.options.rules[e]&&(this.rules[e]=(0,a["default"])(this.rules[e],this.options.rules[e]));for(var n in this.rules[e])this.rules[e][n]&&this.fields[e].classList.add(n)}},{key:"checkForm",value:function(){var e={};for(var t in this.rules){var s=this.checkInput(t);s.length&&(e[t]=s)}return e}},{key:"checkInput",value:function(t){var s=this.rules[t],i=[],r=!e.methods.required.func(e.getInputValue(this.inputs[t]),this.inputs[t]);if(r&&s.required)i.push(this._getErrorMessage(t,"required"));else if(!r)for(var n in s){var o=s[n];if(o)if(e.methods[n]){var a=e.methods[n].func(e.getInputValue(this.inputs[t]),this.inputs[t],o);a||i.push(this._getErrorMessage(t,n))}else i.push('Method "'+n+'" not found')}return i.length?this._markError(t,i):this._markValid(t),i}},{key:"_markError",value:function(e,t){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.error),this.fields[e].classList.remove(this.options.states.valid),this.messages[e].innerHTML=t.join(", "))}},{key:"_markValid",value:function(e){this.fields[e]&&this.messages[e]&&(this.fields[e].classList.add(this.options.states.valid),this.fields[e].classList.remove(this.options.states.error),this.messages[e].innerHTML="")}},{key:"_getErrorMessage",value:function(t,s){var i="";return i=this.options.messages[t]&&this.options.messages[t][s]?this.options.messages[t][s]:e.methods[s].message}}],[{key:"getFormOptions",value:function(e){var t={ajax:{}};return e.getAttribute("method")&&(t.ajax.method=e.getAttribute("method")),e.getAttribute("action")&&(t.ajax.url=e.getAttribute("action")),e.getAttribute("enctype")&&(t.ajax.enctype=e.getAttribute("enctype")),"multipart/form-data"===t.ajax.enctype&&(t.ajax.sendType="formData"),t}},{key:"getRadioGroupValue",value:function(t){for(var s in t){var i=t[s],r=e.getInputValue(i);if(""!==r)return r}return""}},{key:"parseInputName",value:function(t,s){for(var i,r=/(\[(\w*)\]|\w*)/gi,n=[];null!==(i=r.exec(t));)i.index===r.lastIndex&&r.lastIndex++,i[2]?n.push(i[2]):n.push(i[1]);return e.createObject(n,s)}},{key:"createObject",value:function(t,s){var i=t[0];if(0===i.length)return s;if("[]"===i)return[e.createObject(t.slice(1),s)];var r={};return r[i]=e.createObject(t.slice(1),s),r}},{key:"getInputValue",value:function(t){if(Array.isArray(t))return e.getRadioGroupValue(t);var s="",i=t.type;if("select-one"===i)return t.options.length&&(s=t.options[t.selectedIndex].value),s;if("select-multiple"===i){s=[];for(var r=0;r<t.options.length;r++)t.options[r].selected&&s.push(t.options[r].value);return 0===s.length&&(s=""),s}return"checkbox"===i||"radio"===i?t.checked?t.value:"":t.value}}]),e}();u.methods={},u.addMethod=function(e,t,s){u.methods[e]={func:t,message:s}},u.addMethod("required",function(e){return e&&""!==e.trim()},"Это поле необходимо заполнить"),u.addMethod("regexp",function(e,t,s){return s.test(e)},"Пожалуйста, введите корректное значение"),u.addMethod("email",function(e){return/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(e)},"Пожалуйста, введите корректный адрес электронной почты"),u.addMethod("filesize",function(e,t,s){return Array.prototype.slice.call(t.files).reduce(function(e,t){return t.size<s&&e},!0)},"Попробуйте загрузить файл поменьше"),u.addMethod("extension",function(e,t,s){return Array.prototype.slice.call(t.files).reduce(function(e,t){return-1!==s.indexOf(t.name.split(".").pop())&&e},!0)},"Пожалуйста, выберите файл с правильным расширением"),u.addMethod("tel",function(e){return/^([\+]+)*[0-9\x20\x28\x29\-]{5,20}$/.test(e)},"Не корректный номер телефона"),u.addMethod("url",function(e){return/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi.test(e)},"Не корректный url"),e.exports=u},function(e,t,s){var i,r;!function(n,o){i=o,r="function"==typeof i?i.call(t,s,t,e):i,!(void 0!==r&&(e.exports=r))}(this,function(){return function e(t,s){var i=Array.isArray(s),r=i&&[]||{};return i?(t=t||[],r=r.concat(t),s.forEach(function(s,i){"undefined"==typeof r[i]?r[i]=s:"object"==typeof s?r[i]=e(t[i],s):-1===t.indexOf(s)&&r.push(s)})):(t&&"object"==typeof t&&Object.keys(t).forEach(function(e){r[e]=t[e]}),Object.keys(s).forEach(function(i){"object"==typeof s[i]&&s[i]&&t[i]?r[i]=e(t[i],s[i]):r[i]=s[i]})),r}})}])});
//# sourceMappingURL=jedi-validate.min.map