{"version":3,"sources":["jedi-validate.js","jedi-validate.es6"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","JediValidate","root","options","arguments","undefined","this","defaultOptions","ajax","dataType","sendType","rules","messages","containers","parent","message","baseMessage","states","error","valid","callbacks","success","assign","fields","inputs","_cacheNodes","_ready","value","nodes","form","querySelector","querySelectorAll","_this","setAttribute","addEventListener","event","errors","checkForm","keys","preventDefault","ajaxOptions","url","getAttribute","method","_send","forEach","input","name","field","parentNode","classList","contains","messageElement","document","createElement","add","appendChild","_defineRules","checkInput","_this2","data","encodeURIComponent","Utils","getInputValue","slice","xhttp","XMLHttpRequest","open","toUpperCase","onreadystatechange","readyState","status","response","JSON","parse","responseText","e","validationErrors","base","innerHTML","join","remove","_markError","redirect","window","location","href","clean","reset","console","warn","statusText","send","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","_rule","hasAttribute","err","regexp","RegExp","rule","inputErrors","isEmpty","methods","required","func","push","_getErrorMessage","params","_markValid","addMethod","trim","element","test","size","get","files","extensions","indexOf","split","pop","type","selectedIndex","selected","multiple","Array","call","checked"],"mappings":"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","file":"jedi-validate.min.js","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar JediValidate = function () {\n    function JediValidate(root) {\n        var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n        _classCallCheck(this, JediValidate);\n\n        var defaultOptions = {\n            ajax: {\n                dataType: 'json'\n            },\n            sendType: 'serialize',\n            rules: {},\n            messages: {},\n            containers: {\n                parent: 'form-group',\n                message: 'help-block',\n                baseMessage: 'base-error'\n            },\n            states: {\n                error: 'error',\n                valid: 'valid'\n            },\n            callbacks: {\n                success: function success() {},\n                error: function error() {}\n            }\n        };\n\n        this.root = root;\n\n        this.options = Object.assign(defaultOptions, options);\n\n        this.fields = {};\n        this.inputs = {};\n        this.messages = {};\n        this.rules = {};\n\n        this._cacheNodes();\n        this._ready();\n    }\n\n    _createClass(JediValidate, [{\n        key: '_cacheNodes',\n        value: function _cacheNodes() {\n            this.nodes = {\n                form: this.root.querySelector('form'),\n                inputs: this.root.querySelectorAll('[name]'),\n                baseMessage: this.root.querySelector('.' + this.options.containers.baseMessage)\n            };\n        }\n    }, {\n        key: '_ready',\n        value: function _ready() {\n            var _this = this;\n\n            this.nodes.form.setAttribute('novalidate', 'novalidate');\n\n            this.nodes.form.addEventListener('submit', function (event) {\n                var errors = _this.checkForm();\n\n                if (Object.keys(errors).length !== 0) {\n                    _this.options.callbacks.error(errors);\n\n                    event.preventDefault();\n                    return;\n                }\n\n                if (_this.options.ajax) {\n                    event.preventDefault();\n                } else {\n                    return;\n                }\n\n                var ajaxOptions = {};\n\n                ajaxOptions.url = _this.nodes.form.getAttribute('action');\n                ajaxOptions.method = _this.nodes.form.getAttribute('method');\n\n                _this._send(ajaxOptions);\n            });\n\n            this.nodes.inputs.forEach(function (input) {\n                var name = input.name;\n                _this.inputs[name] = input;\n\n                var field = input.parentNode;\n\n                do {\n                    if (field.classList.contains(_this.options.containers.parent)) {\n                        _this.fields[name] = field;\n                        break;\n                    }\n                } while (field = field.parentNode);\n\n                if (!_this.fields[name]) {\n                    throw 'Have no parent field';\n                }\n\n                var messageElement = _this.fields[name].querySelector('.' + _this.options.containers.message);\n\n                if (messageElement) {\n                    _this.messages[name] = messageElement;\n                } else {\n                    _this.messages[name] = document.createElement(\"div\");\n                    _this.messages[name].classList.add(_this.options.containers.message);\n                    _this.fields[name].appendChild(_this.messages[name]);\n                }\n\n                _this._defineRules(name);\n\n                input.addEventListener('change', function () {\n                    _this.checkInput(name);\n                });\n            });\n        }\n    }, {\n        key: '_send',\n        value: function _send(options) {\n            var _this2 = this;\n\n            var data = '';\n\n            this.nodes.inputs.forEach(function (input) {\n                data += input.name + '=' + encodeURIComponent(Utils.getInputValue(input)) + '&';\n            });\n\n            data = data.slice(0, -1);\n\n            var xhttp = new XMLHttpRequest();\n\n            xhttp.open(options.method, options.url + (options.method.toUpperCase() === 'GET' ? '?' + data : ''), true); // todo concat url and params\n\n            xhttp.onreadystatechange = function () {\n                if (xhttp.readyState == 4) {\n                    if (xhttp.status == 200) {\n                        var response = {};\n\n                        try {\n                            response = JSON.parse(xhttp.responseText);\n                        } catch (e) {\n                            response.validationErrors = { base: ['JSON parsing error'] }; // todo: language extension\n                        }\n\n                        if (response.validationErrors) {\n                            _this2.options.callbacks.error(response.validationErrors);\n\n                            if (response.validationErrors.base) {\n                                _this2.nodes.baseMessage.innerHTML = response.validationErrors.base.join(', ');\n                                _this2.root.classList.add(_this2.options.states.error);\n                                _this2.root.classList.remove(_this2.options.states.valid);\n                                delete response.validationErrors.base;\n                            } else {\n                                _this2.nodes.baseMessage.innerHTML = '';\n                            }\n\n                            for (var name in response.validationErrors) {\n                                _this2._markError(name, response.validationErrors[name]);\n                            }\n                        } else {\n                            _this2.options.callbacks.success(response);\n\n                            if (_this2.options.redirect && response.redirect) {\n                                window.location.href = response.redirect;\n                                return;\n                            }\n\n                            if (_this2.options.clean) {\n                                _this2.nodes.form.reset();\n                            }\n                        }\n                    } else {\n                        console.warn(options.method + ' ' + options.url + ' ' + xhttp.status + ' (' + xhttp.statusText + ')');\n\n                        _this2.nodes.baseMessage.innerHTML = 'Can not send form!'; // todo: language extension\n                        _this2.root.classList.add(_this2.options.states.error);\n                        _this2.root.classList.remove(_this2.options.states.valid);\n                    }\n                }\n            };\n\n            xhttp.send(options.method.toUpperCase() === 'POST' ? data : '');\n        }\n    }, {\n        key: '_defineRules',\n        value: function _defineRules(name) {\n            var input = this.inputs[name];\n\n            this.rules[name] = {};\n\n            var rules = ['required', 'email', 'tel', 'url'];\n\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = rules[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var _rule = _step.value;\n\n                    if (input.hasAttribute(_rule) || input.classList.contains(_rule)) {\n                        this.rules[name][_rule] = true;\n                    }\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n\n            if (input.hasAttribute('pattern')) {\n                this.rules[name].regexp = new RegExp(input.getAttribute('pattern'));\n            }\n\n            this.rules[name] = Object.assign(this.rules[name], this.options.rules[name]);\n\n            for (var rule in this.rules[name]) {\n                if (this.rules[name][rule]) {\n                    this.fields[name].classList.add(rule);\n                }\n            }\n        }\n    }, {\n        key: 'checkForm',\n        value: function checkForm() {\n            var errors = {};\n\n            for (var name in this.rules) {\n                var inputErrors = this.checkInput(name);\n\n                if (inputErrors.length) {\n                    errors[name] = inputErrors;\n                }\n            }\n\n            return errors;\n        }\n    }, {\n        key: 'checkInput',\n        value: function checkInput(name) {\n            var rules = this.rules[name];\n            var errors = [];\n            var isEmpty = !JediValidate.methods.required.func(Utils.getInputValue(this.inputs[name]), this.inputs[name]);\n\n            if (isEmpty && rules.required) {\n                errors.push(this._getErrorMessage(name));\n            } else if (!isEmpty) {\n                for (var method in rules) {\n                    var params = rules[method];\n\n                    if (params) {\n                        if (JediValidate.methods[method]) {\n                            var valid = JediValidate.methods[method].func(Utils.getInputValue(this.inputs[name]), this.inputs[name], params);\n\n                            if (!valid) {\n                                errors.push(this._getErrorMessage(name));\n                            }\n                        } else {\n                            errors.push('Method \"' + method + '\" not found');\n                        }\n                    }\n                }\n            }\n\n            if (errors.length) {\n                this._markError(name, errors);\n            } else {\n                this._markValid(name);\n            }\n\n            return errors;\n        }\n    }, {\n        key: '_markError',\n        value: function _markError(name, errors) {\n            if (!this.fields[name] || !this.messages[name]) {\n                return;\n            }\n\n            this.fields[name].classList.add(this.options.states.error);\n            this.fields[name].classList.remove(this.options.states.valid);\n\n            this.messages[name].innerHTML = errors.join(', ');\n        }\n    }, {\n        key: '_markValid',\n        value: function _markValid(name) {\n            if (!this.fields[name] || !this.messages[name]) {\n                return;\n            }\n\n            this.fields[name].classList.add(this.options.states.valid);\n            this.fields[name].classList.remove(this.options.states.error);\n\n            this.messages[name].innerHTML = '';\n        }\n    }, {\n        key: '_getErrorMessage',\n        value: function _getErrorMessage(name) {\n            var message = '';\n\n            if (this.options.messages[name] && this.options.messages[name].required) {\n                message = this.options.messages[name].required;\n            } else {\n                message = JediValidate.methods.required.message;\n            }\n\n            return message;\n        }\n    }]);\n\n    return JediValidate;\n}();\n\nJediValidate.methods = {};\n\nJediValidate.addMethod = function (rule, func, message) {\n    JediValidate.methods[rule] = {\n        func: func,\n        message: message\n    };\n};\n\n// todo languages\n\nJediValidate.addMethod('required', function (value) {\n    return value && value.trim() !== '';\n}, 'Это поле необходимо заполнить');\n\nJediValidate.addMethod('regexp', function (value, element, regexp) {\n    return regexp.test(value);\n}, 'Пожалуйста, введите корректное значение');\n\nJediValidate.addMethod('email', function (value) {\n    return (/[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}/i.test(value)\n    );\n}, 'Пожалуйста, введите корректный адрес электронной почты');\n\nJediValidate.addMethod('filesize', function (value, element, size) {\n    return !element.get(0).files[0] || element.get(0).files[0].size <= size;\n}, 'Попробуйте загрузить файл поменьше');\n\nJediValidate.addMethod('extension', function (value, element, extensions) {\n    return !element.get(0).files[0] || extensions.indexOf(element.get(0).files[0].name.split('.').pop()) > -1;\n}, 'Пожалуйста, выберите файл с правильным расширением');\n\nJediValidate.addMethod('tel', function (value) {\n    return (/^([\\+]+)*[0-9\\x20\\x28\\x29\\-]{5,20}$/.test(value)\n    );\n}, 'Не корректный номер телефона');\n\nJediValidate.addMethod('url', function (value) {\n    return (/[-a-zA-Z0-9@:%_\\+.~#?&//=]{2,256}\\.[a-z]{2,4}\\b(\\/[-a-zA-Z0-9@:%_\\+.~#?&//=]*)?/gi.test(value)\n    );\n}, 'Не корректный url');\n\nvar Utils = {\n    getInputValue: function getFormElementValue(element) {\n        var value = null;\n        var type = element.type;\n\n\n        if (type === 'select-one') {\n            if (element.options.length) {\n                value = element.options[element.selectedIndex].value;\n            }\n\n            return value;\n        }\n\n        if (type === 'select-multiple') {\n            value = [];\n\n            for (var i = 0; i < element.options.length; i++) {\n                if (element.options[i].selected) {\n                    value.push(element.options[i].value);\n                }\n            }\n\n            if (value.length === 0) {\n                value = null;\n            }\n\n            return value;\n        }\n\n        if (type === 'file' && 'files' in element) {\n            if (element.multiple) {\n                value = Array.prototype.slice.call(element.files);\n\n                if (value.length === 0) {\n                    value = null;\n                }\n            } else {\n                value = element.files[0];\n            }\n\n            return value;\n        }\n\n        if (type === 'checkbox' || type === 'radio') {\n            if (element.checked) return element.value;else {\n                return null;\n            }\n        }\n\n        return element.value;\n    }\n};","class JediValidate {\n    constructor(root, options = {}) {\n        const defaultOptions = {\n            ajax: {\n                dataType: 'json'\n            },\n            sendType: 'serialize',\n            rules: {},\n            messages: {},\n            containers: {\n                parent: 'form-group',\n                message: 'help-block',\n                baseMessage: 'base-error'\n            },\n            states: {\n                error: 'error',\n                valid: 'valid'\n            },\n            callbacks: {\n                success: function () {\n                },\n                error: function () {\n                }\n            }\n        };\n\n        this.root = root;\n\n        this.options = Object.assign(defaultOptions, options);\n\n        this.fields = {};\n        this.inputs = {};\n        this.messages = {};\n        this.rules = {};\n\n        this._cacheNodes();\n        this._ready();\n    }\n\n    _cacheNodes() {\n        this.nodes = {\n            form: this.root.querySelector('form'),\n            inputs: this.root.querySelectorAll('[name]'),\n            baseMessage: this.root.querySelector(`.${this.options.containers.baseMessage}`),\n        }\n    }\n\n    _ready() {\n        this.nodes.form.setAttribute('novalidate', 'novalidate');\n\n        this.nodes.form.addEventListener('submit', (event) => {\n            var errors = this.checkForm();\n\n            if (Object.keys(errors).length !== 0) {\n                this.options.callbacks.error(errors);\n\n                event.preventDefault();\n                return;\n            }\n\n            if (this.options.ajax) {\n                event.preventDefault();\n            } else {\n                return;\n            }\n\n            var ajaxOptions = {};\n\n            ajaxOptions.url = this.nodes.form.getAttribute('action');\n            ajaxOptions.method = this.nodes.form.getAttribute('method');\n\n            this._send(ajaxOptions);\n        });\n\n        this.nodes.inputs.forEach((input) => {\n            const name = input.name;\n            this.inputs[name] = input;\n\n            let field = input.parentNode;\n\n            do {\n                if (field.classList.contains(this.options.containers.parent)) {\n                    this.fields[name] = field;\n                    break;\n                }\n            } while (field = field.parentNode);\n\n            if (!this.fields[name]) {\n                throw 'Have no parent field';\n            }\n\n            var messageElement = this.fields[name].querySelector(`.${this.options.containers.message}`);\n\n            if (messageElement) {\n                this.messages[name] = messageElement;\n            } else {\n                this.messages[name] = document.createElement(\"div\");\n                this.messages[name].classList.add(this.options.containers.message);\n                this.fields[name].appendChild(this.messages[name]);\n            }\n\n            this._defineRules(name);\n\n            input.addEventListener('change', () => {\n                this.checkInput(name);\n            });\n        });\n    }\n\n    _send(options) {\n        let data = '';\n\n        this.nodes.inputs.forEach((input) => {\n            data += `${input.name}=${encodeURIComponent(Utils.getInputValue(input))}&`;\n        });\n\n        data = data.slice(0, -1);\n\n        const xhttp = new XMLHttpRequest();\n\n        xhttp.open(options.method, options.url + (options.method.toUpperCase() === 'GET' ? ('?' + data) : ''), true); // todo concat url and params\n\n        xhttp.onreadystatechange = () => {\n            if (xhttp.readyState == 4) {\n                if (xhttp.status == 200) {\n                    let response = {};\n\n                    try {\n                        response = JSON.parse(xhttp.responseText);\n                    } catch (e) {\n                        response.validationErrors = {base: ['JSON parsing error']};  // todo: language extension\n                    }\n\n                    if (response.validationErrors) {\n                        this.options.callbacks.error(response.validationErrors);\n\n                        if (response.validationErrors.base) {\n                            this.nodes.baseMessage.innerHTML = response.validationErrors.base.join(', ');\n                            this.root.classList.add(this.options.states.error);\n                            this.root.classList.remove(this.options.states.valid);\n                            delete response.validationErrors.base;\n                        } else {\n                            this.nodes.baseMessage.innerHTML = '';\n                        }\n\n                        for (let name in response.validationErrors) {\n                            this._markError(name, response.validationErrors[name]);\n                        }\n                    } else {\n                        this.options.callbacks.success(response);\n\n                        if (this.options.redirect && response.redirect) {\n                            window.location.href = response.redirect;\n                            return;\n                        }\n\n                        if (this.options.clean) {\n                            this.nodes.form.reset();\n                        }\n                    }\n                } else {\n                    console.warn(options.method + ' ' + options.url + ' ' + xhttp.status + ' (' + xhttp.statusText + ')');\n\n                    this.nodes.baseMessage.innerHTML = 'Can not send form!'; // todo: language extension\n                    this.root.classList.add(this.options.states.error);\n                    this.root.classList.remove(this.options.states.valid);\n                }\n            }\n        };\n\n        xhttp.send(options.method.toUpperCase() === 'POST' ? data : '');\n    }\n\n    _defineRules(name) {\n        const input = this.inputs[name];\n\n        this.rules[name] = {};\n\n        const rules = ['required', 'email', 'tel', 'url'];\n\n        for (let rule of rules) {\n            if (input.hasAttribute(rule) || input.classList.contains(rule)) {\n                this.rules[name][rule] = true;\n            }\n        }\n\n        if (input.hasAttribute('pattern')) {\n            this.rules[name].regexp = new RegExp(input.getAttribute('pattern'));\n        }\n\n        this.rules[name] = Object.assign(this.rules[name], this.options.rules[name]);\n\n        for (let rule in this.rules[name]) {\n            if (this.rules[name][rule]) {\n                this.fields[name].classList.add(rule);\n            }\n        }\n    }\n\n    checkForm() {\n        var errors = {};\n\n        for (let name in this.rules) {\n            var inputErrors = this.checkInput(name);\n\n            if (inputErrors.length) {\n                errors[name] = inputErrors;\n            }\n        }\n\n        return errors;\n    }\n\n    checkInput(name) {\n        const rules = this.rules[name];\n        const errors = [];\n        const isEmpty = !JediValidate.methods.required.func(Utils.getInputValue(this.inputs[name]), this.inputs[name]);\n\n        if (isEmpty && rules.required) {\n            errors.push(this._getErrorMessage(name));\n        } else if (!isEmpty) {\n            for (let method in rules) {\n                const params = rules[method];\n\n                if (params) {\n                    if (JediValidate.methods[method]) {\n                        var valid = JediValidate.methods[method].func(Utils.getInputValue(this.inputs[name]), this.inputs[name], params);\n\n                        if (!valid) {\n                            errors.push(this._getErrorMessage(name));\n                        }\n                    } else {\n                        errors.push('Method \"' + method + '\" not found');\n                    }\n                }\n            }\n        }\n\n        if (errors.length) {\n            this._markError(name, errors);\n        } else {\n            this._markValid(name);\n        }\n\n        return errors;\n    }\n\n    _markError(name, errors) {\n        if (!this.fields[name] || !this.messages[name]) {\n            return;\n        }\n\n        this.fields[name].classList.add(this.options.states.error);\n        this.fields[name].classList.remove(this.options.states.valid);\n\n        this.messages[name].innerHTML = errors.join(', ');\n    }\n\n    _markValid(name) {\n        if (!this.fields[name] || !this.messages[name]) {\n            return;\n        }\n\n        this.fields[name].classList.add(this.options.states.valid);\n        this.fields[name].classList.remove(this.options.states.error);\n\n        this.messages[name].innerHTML = '';\n    }\n\n    _getErrorMessage(name) {\n        let message = '';\n\n        if (this.options.messages[name] && this.options.messages[name].required) {\n            message = this.options.messages[name].required;\n        } else {\n            message = JediValidate.methods.required.message;\n        }\n\n        return message;\n    };\n}\n\nJediValidate.methods = {};\n\nJediValidate.addMethod = function (rule, func, message) {\n    JediValidate.methods[rule] = {\n        func: func,\n        message: message\n    };\n};\n\n// todo languages\n\nJediValidate.addMethod('required', function (value) {\n    return (value && value.trim() !== '');\n}, 'Это поле необходимо заполнить');\n\nJediValidate.addMethod('regexp', function (value, element, regexp) {\n    return regexp.test(value);\n}, 'Пожалуйста, введите корректное значение');\n\nJediValidate.addMethod('email', function (value) {\n    return /[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}/i.test(value);\n}, 'Пожалуйста, введите корректный адрес электронной почты');\n\nJediValidate.addMethod('filesize', function (value, element, size) {\n    return !element.get(0).files[0] || element.get(0).files[0].size <= size;\n}, 'Попробуйте загрузить файл поменьше');\n\nJediValidate.addMethod('extension', function (value, element, extensions) {\n    return !element.get(0).files[0] || extensions.indexOf(element.get(0).files[0].name.split('.').pop()) > -1;\n}, 'Пожалуйста, выберите файл с правильным расширением');\n\nJediValidate.addMethod('tel', function (value) {\n    return /^([\\+]+)*[0-9\\x20\\x28\\x29\\-]{5,20}$/.test(value);\n}, 'Не корректный номер телефона');\n\nJediValidate.addMethod('url', function (value) {\n    return /[-a-zA-Z0-9@:%_\\+.~#?&//=]{2,256}\\.[a-z]{2,4}\\b(\\/[-a-zA-Z0-9@:%_\\+.~#?&//=]*)?/gi.test(value);\n}, 'Не корректный url');\n\nvar Utils = {\n    getInputValue: function getFormElementValue(element) {\n        let value = null;\n        let {type} = element;\n\n        if (type === 'select-one') {\n            if (element.options.length) {\n                value = element.options[element.selectedIndex].value;\n            }\n\n            return value;\n        }\n\n        if (type === 'select-multiple') {\n            value = [];\n\n            for (let i = 0; i < element.options.length; i++) {\n                if (element.options[i].selected) {\n                    value.push(element.options[i].value);\n                }\n            }\n\n            if (value.length === 0) {\n                value = null\n            }\n\n            return value;\n        }\n\n        if (type === 'file' && 'files' in element) {\n            if (element.multiple) {\n                value = Array.prototype.slice.call(element.files);\n\n                if (value.length === 0) {\n                    value = null\n                }\n            } else {\n                value = element.files[0]\n            }\n\n            return value;\n        }\n\n        if (type === 'checkbox' || type === 'radio') {\n            if (element.checked)\n                return element.value;\n            else {\n                return null;\n            }\n        }\n\n        return element.value;\n    }\n};\n"],"sourceRoot":"/source/"}